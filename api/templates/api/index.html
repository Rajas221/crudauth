<!DOCTYPE html>
<html>
<head>
  <title>User Info App</title>
  <style>
    body { font-family: Arial; margin: 40px; }
    input, textarea { display: block; margin: 10px 0; padding: 8px; width: 300px; }
    button { padding: 8px 12px; margin-top: 10px; cursor: pointer; }
    .section { margin-bottom: 30px; }
  </style>
</head>
<body>
  <h1>User Registration and Profile</h1>

  <div id="register-section" class="section">
    <h3>Register</h3>
    <input id="reg-username" placeholder="Username">
    <input id="reg-email" placeholder="Email">
    <input id="reg-password" type="password" placeholder="Password">
    <button onclick="registerUser()">Register</button>
  </div>

  <div id="login-section" class="section">
    <h3>Login</h3>
    <input id="login-username" placeholder="Username">
    <input id="login-password" type="password" placeholder="Password">
    <button onclick="loginUser()">Login</button>
  </div>

  <div id="profile-section" class="section" style="display:none;">
    <h3>Your Information</h3>
    <input id="full_name" placeholder="Full Name">
    <input id="phone" placeholder="Phone Number">
    <textarea id="address" placeholder="Address"></textarea>
    <button onclick="saveProfile()">Save Info</button>
  </div>

  <script>
    const baseURL = "http://127.0.0.1:8000/api/";
    let accessToken = "";

    async function registerUser() {
      const username = document.getElementById("reg-username").value;
      const email = document.getElementById("reg-email").value;
      const password = document.getElementById("reg-password").value;

      await fetch(baseURL + "register/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, email, password })
      });

      alert("Registered successfully! Now log in.");
    }

    async function loginUser() {
      const username = document.getElementById("login-username").value;
      const password = document.getElementById("login-password").value;

      const res = await fetch(baseURL + "login/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();
      if (data.access) {
        accessToken = data.access;
        document.getElementById("profile-section").style.display = "block";
        await loadProfile();
      } else {
        alert("Login failed!");
      }
    }

    async function loadProfile() {
      const res = await fetch(baseURL + "profile/", {
        headers: { "Authorization": `Bearer ${accessToken}` }
      });
      const data = await res.json();

      document.getElementById("full_name").value = data.full_name || "";
      document.getElementById("phone").value = data.phone || "";
      document.getElementById("address").value = data.address || "";
    }

    async function saveProfile() {
      const full_name = document.getElementById("full_name").value;
      const phone = document.getElementById("phone").value;
      const address = document.getElementById("address").value;

      const res = await fetch(baseURL + "profile/", {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${accessToken}`
        },
        body: JSON.stringify({ full_name, phone, address })
      });

      if (res.ok) {
        alert("Profile saved successfully!");
      } else {
        alert("Error saving profile!");
      }
    }
  </script>
</body>
</html>
